<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø³Ù„ÙˆÙƒ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø­Ø³Ù‘Ù†</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --participation: #2980b9;  /* Ø£Ø²Ø±Ù‚ - Ù…Ø´Ø§Ø±ÙƒØ© */
            --good-behavior: #27ae60;   /* Ø£Ø®Ø¶Ø± - Ø³Ù„ÙˆÙƒ Ø­Ø³Ù† */
            --absent: #f1c40f;          /* Ø£ØµÙØ± - ØºÙŠØ§Ø¨ */
            --talking: #e74c3c;         /* Ø£Ø­Ù…Ø± - ÙŠØªÙƒÙ„Ù… */
            --bad-behavior: #8e44ad;    /* Ø¨Ù†ÙØ³Ø¬ÙŠ - Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡ */
            --tab-active: #2c3e50;
            --tab-inactive: #7f8c8d;
        }

        * {
            box-sizing: border-box;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0; 
            padding: 0; 
            min-height: 100vh;
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .main-card {
            background: white;
            border-radius: 25px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.2);
            overflow: hidden;
            min-height: 85vh;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .app-header {
            background: linear-gradient(to right, #2c3e50, #3498db);
            color: white;
            padding: 25px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-title h1 {
            margin: 0;
            font-size: 2.2rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-title p {
            margin: 5px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .header-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 25px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
        }

        /* ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ÙØµÙˆÙ„ */
        .class-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            padding: 0 40px;
        }

        .class-tab {
            flex: 1;
            text-align: center;
            padding: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
            color: var(--tab-inactive);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .class-tab:hover {
            background: #edf2f7;
            color: var(--tab-active);
        }

        .class-tab.active {
            color: var(--tab-active);
            border-bottom-color: var(--tab-active);
            background: white;
        }

        /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØµÙ„ */
        .class-content {
            padding: 30px 40px;
            display: none;
        }

        .class-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„Ù„ÙØµÙ„ */
        .class-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border-top: 5px solid;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.8rem;
            font-weight: bold;
            margin: 10px 0;
            display: block;
        }

        .stat-label {
            font-size: 1rem;
            color: #7f8c8d;
            display: block;
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .control-panel {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            border: 2px dashed #dee2e6;
        }

        .panel-title {
            margin-top: 0;
            color: #2c3e50;
            font-size: 1.4rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group label {
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.95rem;
        }

        input, select, textarea {
            padding: 14px;
            border-radius: 12px;
            border: 2px solid #dee2e6;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
        }

        .btn-primary {
            background: linear-gradient(to right, #3498db, #2ecc71);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ */
        .students-list {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 30px;
        }

        .list-header {
            background: #f8f9fa;
            padding: 20px;
            display: grid;
            grid-template-columns: 2fr 1fr 2fr;
            font-weight: bold;
            color: #2c3e50;
            border-bottom: 2px solid #e9ecef;
        }

        .list-body {
            max-height: 500px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #c1c1c1 #f1f1f1;
        }

        .student-row {
            display: grid;
            grid-template-columns: 2fr 1fr 2fr;
            padding: 20px;
            border-bottom: 1px solid #f1f1f1;
            transition: background 0.3s ease;
            align-items: center;
        }

        .student-row:hover {
            background: #f8fafc;
        }

        .student-info {
            display: flex;
            flex-direction: column;
        }

        .student-name {
            font-weight: 700;
            color: #2d3748;
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .student-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            color: #4a5568;
        }

        .stat-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .percentage-display {
            text-align: center;
        }

        .percentage-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.4rem;
            position: relative;
            margin: 0 auto;
            background: conic-gradient(#4caf50 0% var(--percentage), #f0f0f0 var(--percentage) 100%);
        }

        .percentage-circle::before {
            content: attr(data-percentage) '%';
            position: absolute;
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .student-score {
            font-size: 1.1rem;
            margin-top: 10px;
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-action {
            border: none;
            width: 55px;
            height: 55px;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            font-size: 1.3rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .btn-action:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .btn-action:active {
            transform: scale(0.95);
        }

        .btn-report {
            background: #718096;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
        }

        .btn-report:hover {
            background: #4a5568;
            transform: translateY(-2px);
        }

        /* ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ù„ÙˆØ§Ù† */
        .color-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #4a5568;
            background: white;
            padding: 10px 15px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 900px;
            margin: 30px auto;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.5s ease;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(to right, #2c3e50, #3498db);
            color: white;
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 30px;
        }

        .close-modal {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        /* Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 15px 25px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            z-index: 10000;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        @keyframes slideIn {
            from { transform: translateX(-100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(-100px); opacity: 0; }
        }

        /* Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */
        .quick-add {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: #2ecc71;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(46, 204, 113, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            border: none;
        }

        .quick-add:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 15px 35px rgba(46, 204, 113, 0.4);
        }

        /* Ø§Ù„ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 1024px) {
            .app-container {
                padding: 10px;
            }
            
            .app-header {
                padding: 20px;
                flex-direction: column;
                text-align: center;
            }
            
            .class-tabs {
                padding: 0;
            }
            
            .class-content {
                padding: 20px;
            }
            
            .student-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .list-header {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .class-tabs {
                flex-direction: column;
            }
            
            .input-row {
                grid-template-columns: 1fr;
            }
            
            .header-title h1 {
                font-size: 1.8rem;
            }
            
            .btn-action {
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
    <button class="quick-add" onclick="toggleQuickAdd()">+</button>

    <div class="app-container">
        <div class="main-card">
            <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
            <div class="app-header">
                <div class="header-title">
                    <h1>ğŸ« Ù†Ø¸Ø§Ù… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø³Ù„ÙˆÙƒ</h1>
                    <p>Ø£Ø¯Ø§Ø© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„ØªÙ‚ÙŠÙŠÙ… Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØªØªØ¨Ø¹ Ø³Ù„ÙˆÙƒÙ‡Ù…</p>
                </div>
                <div class="header-actions">
                    <button class="header-btn" onclick="exportAllData()">
                        ğŸ“Š ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                    <button class="header-btn" onclick="showSummary()">
                        ğŸ“ˆ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø®Øµ
                    </button>
                    <button class="header-btn" onclick="showSettings()">
                        âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </button>
                </div>
            </div>

            <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ÙØµÙˆÙ„ -->
            <div class="class-tabs">
                <div class="class-tab active" onclick="showClass('class1')">
                    ğŸ“š Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„
                    <span class="student-count" id="tab-count-1">0</span>
                </div>
                <div class="class-tab" onclick="showClass('class2')">
                    ğŸ“š Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ
                    <span class="student-count" id="tab-count-2">0</span>
                </div>
                <div class="class-tab" onclick="showClass('class3')">
                    ğŸ“š Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«
                    <span class="student-count" id="tab-count-3">0</span>
                </div>
            </div>

            <!-- ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ù„ÙˆØ§Ù† -->
            <div class="color-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--participation);"></div>
                    <span>+Ù¢ Ù…Ø´Ø§Ø±ÙƒØ©</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--good-behavior);"></div>
                    <span>+Ù¡ Ø³Ù„ÙˆÙƒ Ø­Ø³Ù†</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--absent);"></div>
                    <span>Ù  ØºÙŠØ§Ø¨</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--talking);"></div>
                    <span>-Ù¡ ÙŠØªÙƒÙ„Ù…</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--bad-behavior);"></div>
                    <span>-Ù¢ Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡</span>
                </div>
            </div>

            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØµÙˆÙ„ -->
            <div id="class1-content" class="class-content active">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>

            <div id="class2-content" class="class-content">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>

            <div id="class3-content" class="class-content">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="reportTitle" style="margin: 0; font-size: 1.8rem;">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
                <button class="close-modal" onclick="closeReportModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div id="reportContent">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
    <div id="quickAddModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin: 0; font-size: 1.8rem;">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø³Ø±ÙŠØ¹Ø©</h2>
                <button class="close-modal" onclick="closeQuickAddModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>Ø§Ø®ØªØ± Ø§Ù„ØµÙ:</label>
                    <select id="quickClassSelect">
                        <option value="class1">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„</option>
                        <option value="class2">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                        <option value="class3">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
                    <input type="text" id="quickStudentName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
                </div>
                <button class="btn-primary" onclick="addQuickStudent()" style="margin-top: 20px;">
                    â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨
                </button>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù…Ù„Ø®Øµ -->
    <div id="summaryModal" class="modal">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h2 style="margin: 0; font-size: 1.8rem;">ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù†Ø¸Ø§Ù…</h2>
                <button class="close-modal" onclick="closeSummaryModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div id="summaryContent">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
        </div>
    </div>

<script>
    // ØªØ¹Ø±ÙŠÙ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØµØ±ÙØ§Øª
    const ACTION_TYPES = {
        PARTICIPATION: {
            value: 2,
            color: '#2980b9',
            name: 'Ù…Ø´Ø§Ø±ÙƒØ©',
            arabicName: 'Ù…Ø´Ø§Ø±ÙƒØ©',
            icon: 'ğŸ’¬'
        },
        GOOD_BEHAVIOR: {
            value: 1,
            color: '#27ae60',
            name: 'Ø³Ù„ÙˆÙƒ Ø­Ø³Ù†',
            arabicName: 'Ø³Ù„ÙˆÙƒ Ø­Ø³Ù†',
            icon: 'ğŸ‘'
        },
        ABSENT: {
            value: 0,
            color: '#f1c40f',
            name: 'ØºÙŠØ§Ø¨',
            arabicName: 'ØºÙŠØ§Ø¨',
            icon: 'ğŸ“'
        },
        TALKING: {
            value: -1,
            color: '#e74c3c',
            name: 'ÙŠØªÙƒÙ„Ù…',
            arabicName: 'ÙŠØªÙƒÙ„Ù…',
            icon: 'ğŸ—£ï¸'
        },
        BAD_BEHAVIOR: {
            value: -2,
            color: '#8e44ad',
            name: 'Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡',
            arabicName: 'Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡',
            icon: 'ğŸ‘'
        }
    };

    // Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    let db = JSON.parse(localStorage.getItem('behaviorDB')) || { 
        class1: {}, 
        class2: {}, 
        class3: {},
        stats: {
            totalActions: 0,
            lastUpdate: null
        }
    };

    // Ø§Ù„ÙØµÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶
    let currentClass = 'class1';

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    function initSystem() {
        if (!db.stats) {
            db.stats = {
                totalActions: 0,
                lastUpdate: new Date().toISOString()
            };
        }
        saveToStorage();
        renderAllClasses();
    }

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function saveToStorage() {
        localStorage.setItem('behaviorDB', JSON.stringify(db));
    }

    // Ø¹Ø±Ø¶ ÙØµÙ„ Ù…Ø¹ÙŠÙ†
    function showClass(className) {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø·
        document.querySelectorAll('.class-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        document.querySelectorAll('.class-content').forEach(content => {
            content.classList.remove('active');
        });

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø´Ø· Ù„Ù„ØªØ¨ÙˆÙŠØ¨ ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ø¯Ø¯
        event.currentTarget.classList.add('active');
        document.getElementById(`${className}-content`).classList.add('active');
        currentClass = className;

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ÙØµÙ„
        renderClass(className);
    }

    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©
    function calculatePercentage(student) {
        if (student.actions.length === 0) return 50;
        
        const totalPossible = student.actions.length * 2;
        const totalEarned = student.totalScore + (student.actions.length * 2);
        
        return Math.max(0, Math.min(100, Math.round((totalEarned / (totalPossible * 2)) * 100)));
    }

    // Ø¥Ø¶Ø§ÙØ© ØªØµØ±Ù Ù„Ù„Ø·Ø§Ù„Ø¨
    function addAction(cls, name, actionType) {
        if (!db[cls][name]) return;
        
        const action = {
            type: actionType.name,
            value: actionType.value,
            arabicName: actionType.arabicName,
            color: actionType.color,
            timestamp: new Date().toISOString(),
            date: new Date().toLocaleDateString('ar-SA'),
            time: new Date().toLocaleTimeString('ar-SA')
        };
        
        db[cls][name].actions.push(action);
        db[cls][name].totalScore += actionType.value;
        db[cls][name].lastAction = new Date().toISOString();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        switch(actionType.name) {
            case 'Ù…Ø´Ø§Ø±ÙƒØ©': db[cls][name].stats.participation++; break;
            case 'Ø³Ù„ÙˆÙƒ Ø­Ø³Ù†': db[cls][name].stats.goodBehavior++; break;
            case 'ØºÙŠØ§Ø¨': db[cls][name].stats.absent++; break;
            case 'ÙŠØªÙƒÙ„Ù…': db[cls][name].stats.talking++; break;
            case 'Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡': db[cls][name].stats.badBehavior++; break;
        }
        
        db.stats.totalActions++;
        db.stats.lastUpdate = new Date().toISOString();
        
        saveToStorage();
        renderClass(cls);
        
        // Ø¥Ø´Ø¹Ø§Ø±
        showNotification(`${actionType.arabicName} ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${name} Ù„Ù€`, actionType.color);
    }

    // Ø¹Ø±Ø¶ Ø§Ù„ÙØµÙ„
    function renderClass(className) {
        const container = document.getElementById(`${className}-content`);
        const students = db[className];
        const studentCount = Object.keys(students).length;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        document.getElementById(`tab-count-${className.slice(-1)}`).textContent = studentCount;

        if (studentCount === 0) {
            container.innerHTML = `
                <div class="control-panel">
                    <h3 class="panel-title">ğŸ“ Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø§Ø¨ Ù„Ù„ØµÙ</h3>
                    <div class="input-row">
                        <div class="input-group">
                            <label>Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨ (Ø³Ø·Ø± Ù„ÙƒÙ„ Ø§Ø³Ù…):</label>
                            <textarea id="nameList" rows="5" placeholder="Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨..."></textarea>
                        </div>
                        <div class="input-group">
                            <label>Ø£Ùˆ Ø±ÙØ¹ Ù…Ù„Ù Ø¥ÙƒØ³Ù„:</label>
                            <input type="file" id="excelFile" accept=".xlsx, .xls">
                        </div>
                    </div>
                    <button class="btn-primary" onclick="addStudentsFromText('${className}')">
                        â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ù„Ø§Ø¨
                    </button>
                </div>
                <div style="text-align: center; padding: 60px 20px; color: #a0aec0;">
                    <div style="font-size: 5rem; margin-bottom: 20px;">ğŸ‘¨â€ğŸ“</div>
                    <h3 style="margin-bottom: 10px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØµÙ</h3>
                    <p>Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø§Ø¨</p>
                </div>
            `;
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø­Ø¯Ø« Ù„Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„
            document.getElementById('excelFile').addEventListener('change', function(e) {
                handleExcelUpload(e, className);
            });
            
            return;
        }

        // Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙØµÙ„
        let classStats = {
            totalStudents: studentCount,
            totalScore: 0,
            totalActions: 0,
            participation: 0,
            goodBehavior: 0,
            absent: 0,
            talking: 0,
            badBehavior: 0
        };

        Object.values(students).forEach(student => {
            classStats.totalScore += student.totalScore;
            classStats.totalActions += student.actions.length;
            classStats.participation += student.stats.participation;
            classStats.goodBehavior += student.stats.goodBehavior;
            classStats.absent += student.stats.absent;
            classStats.talking += student.stats.talking;
            classStats.badBehavior += student.stats.badBehavior;
        });

        const avgScore = (classStats.totalScore / studentCount).toFixed(1);
        const avgPercentage = classStats.totalActions > 0 ? 
            Math.round((classStats.totalScore + (classStats.totalActions * 2)) / (classStats.totalActions * 4) * 100) : 0;

        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØµÙ„
        let content = `
            <div class="class-stats">
                <div class="stat-card" style="border-top-color: #3498db;">
                    <span class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                    <span class="stat-value">${classStats.totalStudents}</span>
                </div>
                <div class="stat-card" style="border-top-color: #2ecc71;">
                    <span class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·</span>
                    <span class="stat-value" style="color: ${avgScore >= 0 ? '#27ae60' : '#e74c3c'}">
                        ${avgScore >= 0 ? '+' : ''}${avgScore}
                    </span>
                </div>
                <div class="stat-card" style="border-top-color: #9b59b6;">
                    <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØµØ±ÙØ§Øª</span>
                    <span class="stat-value">${classStats.totalActions}</span>
                </div>
                <div class="stat-card" style="border-top-color: #f1c40f;">
                    <span class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ø³Ø¨Ø©</span>
                    <span class="stat-value">${avgPercentage}%</span>
                </div>
            </div>

            <div class="control-panel">
                <h3 class="panel-title">ğŸ“ Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø§Ø¨ Ø¬Ø¯Ø¯</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨ (Ø³Ø·Ø± Ù„ÙƒÙ„ Ø§Ø³Ù…):</label>
                        <textarea id="nameList" rows="3" placeholder="Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨..."></textarea>
                    </div>
                    <div class="input-group">
                        <label>Ø£Ùˆ Ø±ÙØ¹ Ù…Ù„Ù Ø¥ÙƒØ³Ù„:</label>
                        <input type="file" id="excelFile" accept=".xlsx, .xls">
                    </div>
                </div>
                <button class="btn-primary" onclick="addStudentsFromText('${className}')">
                    â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ù„Ø§Ø¨
                </button>
            </div>

            <div class="students-list">
                <div class="list-header">
                    <div>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</div>
                    <div>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div>
                    <div>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</div>
                </div>
                <div class="list-body">
        `;

        // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
        const sortedStudents = Object.entries(students).sort((a, b) => {
            return b[1].totalScore - a[1].totalScore;
        });

        sortedStudents.forEach(([name, data], index) => {
            const percentage = calculatePercentage(data);
            const stats = data.stats;
            
            content += `
                <div class="student-row">
                    <div class="student-info">
                        <div class="student-name">
                            <span style="color: #718096; margin-left: 10px;">#${index + 1}</span>
                            ${name}
                        </div>
                        <div class="student-stats">
                            <div class="stat-item">
                                <div class="stat-dot" style="background: ${ACTION_TYPES.PARTICIPATION.color}"></div>
                                <span>${stats.participation}</span>
                            </div>
                            <div class="stat-item">
                                <div class="stat-dot" style="background: ${ACTION_TYPES.GOOD_BEHAVIOR.color}"></div>
                                <span>${stats.goodBehavior}</span>
                            </div>
                            <div class="stat-item">
                                <div class="stat-dot" style="background: ${ACTION_TYPES.ABSENT.color}"></div>
                                <span>${stats.absent}</span>
                            </div>
                            <div class="stat-item">
                                <div class="stat-dot" style="background: ${ACTION_TYPES.TALKING.color}"></div>
                                <span>${stats.talking}</span>
                            </div>
                            <div class="stat-item">
                                <div class="stat-dot" style="background: ${ACTION_TYPES.BAD_BEHAVIOR.color}"></div>
                                <span>${stats.badBehavior}</span>
                            </div>
                        </div>
                        <button class="btn-report" onclick="showStudentReport('${className}', '${name}')">
                            ğŸ“„ ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„
                        </button>
                    </div>
                    <div class="percentage-display">
                        <div class="percentage-circle" style="--percentage: ${percentage}%;" data-percentage="${percentage}"></div>
                        <div class="student-score" style="color: ${data.totalScore >= 0 ? '#27ae60' : '#e74c3c'}">
                            ${data.totalScore > 0 ? '+' : ''}${data.totalScore} Ù†Ù‚Ø·Ø©
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn-action" style="background: ${ACTION_TYPES.PARTICIPATION.color}"
                                onclick="addAction('${className}', '${name}', ACTION_TYPES.PARTICIPATION)"
                                title="Ù…Ø´Ø§Ø±ÙƒØ© +Ù¢">
                            +Ù¢
                        </button>
                        <button class="btn-action" style="background: ${ACTION_TYPES.GOOD_BEHAVIOR.color}"
                                onclick="addAction('${className}', '${name}', ACTION_TYPES.GOOD_BEHAVIOR)"
                                title="Ø³Ù„ÙˆÙƒ Ø­Ø³Ù† +Ù¡">
                            +Ù¡
                        </button>
                        <button class="btn-action" style="background: ${ACTION_TYPES.ABSENT.color}"
                                onclick="addAction('${className}', '${name}', ACTION_TYPES.ABSENT)"
                                title="ØºÙŠØ§Ø¨ Ù ">
                            Ù 
                        </button>
                        <button class="btn-action" style="background: ${ACTION_TYPES.TALKING.color}"
                                onclick="addAction('${className}', '${name}', ACTION_TYPES.TALKING)"
                                title="ÙŠØªÙƒÙ„Ù… -Ù¡">
                            -Ù¡
                        </button>
                        <button class="btn-action" style="background: ${ACTION_TYPES.BAD_BEHAVIOR.color}"
                                onclick="addAction('${className}', '${name}', ACTION_TYPES.BAD_BEHAVIOR)"
                                title="Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡ -Ù¢">
                            -Ù¢
                        </button>
                    </div>
                </div>
            `;
        });

        content += `
                </div>
            </div>
        `;

        container.innerHTML = content;
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø­Ø¯Ø« Ù„Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„
        document.getElementById('excelFile').addEventListener('change', function(e) {
            handleExcelUpload(e, className);
        });
    }

    // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµÙˆÙ„
    function renderAllClasses() {
        ['class1', 'class2', 'class3'].forEach(cls => {
            renderClass(cls);
        });
    }

    // Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø§Ø¨ Ù…Ù† Ø§Ù„Ù†Øµ
    function addStudentsFromText(className) {
        const textarea = document.querySelector(`#${className}-content textarea`);
        if (!textarea) return;
        
        const text = textarea.value;
        const names = text.split('\n').map(n => n.trim()).filter(n => n !== "");
        
        names.forEach(name => { 
            if (!db[className][name]) {
                db[className][name] = { 
                    totalScore: 0,
                    actions: [],
                    stats: {
                        participation: 0,
                        goodBehavior: 0,
                        absent: 0,
                        talking: 0,
                        badBehavior: 0
                    },
                    lastAction: null,
                    createdAt: new Date().toISOString()
                };
            }
        });
        
        if (textarea) textarea.value = '';
        saveToStorage();
        renderClass(className);
        
        if (names.length > 0) {
            showNotification(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${names.length} Ø·Ø§Ù„Ø¨ Ù„Ù„ØµÙ`, '#2ecc71');
        }
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„
    function handleExcelUpload(event, className) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                
                let addedCount = 0;
                rows.forEach(row => {
                    if (row[0]) {
                        const name = row[0].toString().trim();
                        if (name && !db[className][name]) {
                            db[className][name] = {
                                totalScore: 0,
                                actions: [],
                                stats: {
                                    participation: 0,
                                    goodBehavior: 0,
                                    absent: 0,
                                    talking: 0,
                                    badBehavior: 0
                                },
                                lastAction: null,
                                createdAt: new Date().toISOString()
                            };
                            addedCount++;
                        }
                    }
                });
                
                saveToStorage();
                renderClass(className);
                showNotification(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${addedCount} Ø·Ø§Ù„Ø¨ Ù…Ù† Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„`, '#3498db');
                event.target.value = '';
            } catch (error) {
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„', '#e74c3c');
                console.error(error);
            }
        };
        reader.readAsArrayBuffer(file);
    }

    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
    function toggleQuickAdd() {
        document.getElementById('quickAddModal').style.display = 'block';
    }

    function closeQuickAddModal() {
        document.getElementById('quickAddModal').style.display = 'none';
    }

    // Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø³Ø±ÙŠØ¹
    function addQuickStudent() {
        const className = document.getElementById('quickClassSelect').value;
        const name = document.getElementById('quickStudentName').value.trim();
        
        if (!name) {
            showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨', '#e74c3c');
            return;
        }
        
        if (!db[className][name]) {
            db[className][name] = {
                totalScore: 0,
                actions: [],
                stats: {
                    participation: 0,
                    goodBehavior: 0,
                    absent: 0,
                    talking: 0,
                    badBehavior: 0
                },
                lastAction: null,
                createdAt: new Date().toISOString()
            };
            
            saveToStorage();
            renderClass(className);
            
            // Ø¹Ø±Ø¶ Ø§Ù„ÙØµÙ„ Ø§Ù„Ù…Ø¶Ø§Ù Ø¥Ù„ÙŠÙ‡
            showClass(className);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('quickStudentName').value = '';
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
            closeQuickAddModal();
            
            showNotification(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ ${name}`, '#2ecc71');
        } else {
            showNotification('Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', '#f1c40f');
        }
    }

    // Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨
    function showStudentReport(className, name) {
        const student = db[className][name];
        if (!student) return;
        
        const classNames = {
            'class1': 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„',
            'class2': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ',
            'class3': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«'
        };
        
        const percentage = calculatePercentage(student);
        
        let reportHTML = `
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <h3 style="margin-top: 0; color: #2d3748;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
                    <div style="background: #f8fafc; padding: 25px; border-radius: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                            <div>
                                <div style="font-size: 0.9rem; color: #718096;">Ø§Ù„Ø§Ø³Ù…</div>
                                <div style="font-size: 1.8rem; font-weight: bold; color: #2c3e50;">${name}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9rem; color: #718096;">Ø§Ù„ØµÙ</div>
                                <div style="font-size: 1.8rem; font-weight: bold; color: #2c3e50;">${classNames[className]}</div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                                <div style="font-size: 0.9rem; color: #718096;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                                <div style="font-size: 2.2rem; font-weight: bold; color: ${student.totalScore >= 0 ? '#27ae60' : '#e74c3c'}">
                                    ${student.totalScore > 0 ? '+' : ''}${student.totalScore}
                                </div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                                <div style="font-size: 0.9rem; color: #718096;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØµØ±ÙØ§Øª</div>
                                <div style="font-size: 2.2rem; font-weight: bold; color: #3498db;">${student.actions.length}</div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                                <div style="font-size: 0.9rem; color: #718096;">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
                                <div style="font-size: 2.2rem; font-weight: bold; color: #9b59b6;">${percentage}%</div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                                <div style="font-size: 0.9rem; color: #718096;">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</div>
                                <div style="font-size: 1.2rem; font-weight: bold; color: #e67e22;">
                                    ${student.lastAction ? new Date(student.lastAction).toLocaleDateString('ar-SA') : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px; color: #2d3748;">Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹</h3>
                    <div id="chartContainer" style="height: 200px; display: flex; align-items: flex-end; gap: 10px; margin-top: 20px;">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </div>
                </div>
                
                <div>
                    <h3 style="margin-top: 0; color: #2d3748;">Ø³Ø¬Ù„ Ø§Ù„ØªØµØ±ÙØ§Øª</h3>
                    <div style="max-height: 400px; overflow-y: auto; border: 2px solid #edf2f7; border-radius: 12px; padding: 15px;">
        `;
        
        if (student.actions.length === 0) {
            reportHTML += `
                <div style="text-align: center; padding: 40px; color: #a0aec0;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">ğŸ“</div>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØµØ±ÙØ§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</p>
                </div>
            `;
        } else {
            const recentActions = [...student.actions].reverse().slice(0, 15);
            
            recentActions.forEach(action => {
                reportHTML += `
                    <div style="padding: 12px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: bold; margin-bottom: 5px;">${action.arabicName}</div>
                            <div style="font-size: 0.85rem; color: #718096;">
                                ${action.date} - ${action.time}
                            </div>
                        </div>
                        <div>
                            <span style="background: ${action.color}; color: white; padding: 5px 12px; border-radius: 20px; font-weight: bold;">
                                ${action.value > 0 ? '+' : ''}${action.value}
                            </span>
                        </div>
                    </div>
                `;
            });
        }
        
        reportHTML += `
                    </div>
                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button onclick="exportStudentReport('${className}', '${name}')" 
                                style="background: #2ecc71; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1;">
                            ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                        <button onclick="resetStudent('${className}', '${name}')" 
                                style="background: #e74c3c; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1;">
                            ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.getElementById('reportTitle').textContent = `ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨: ${name}`;
        document.getElementById('reportContent').innerHTML = reportHTML;
        document.getElementById('reportModal').style.display = 'block';
        
        // Ø±Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
        setTimeout(() => drawChart(student.stats), 100);
    }

    // Ø±Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
    function drawChart(stats) {
        const container = document.getElementById('chartContainer');
        if (!container) return;
        
        const chartData = [
            { label: 'Ù…Ø´Ø§Ø±ÙƒØ©', value: stats.participation, color: ACTION_TYPES.PARTICIPATION.color },
            { label: 'Ø³Ù„ÙˆÙƒ Ø­Ø³Ù†', value: stats.goodBehavior, color: ACTION_TYPES.GOOD_BEHAVIOR.color },
            { label: 'ØºÙŠØ§Ø¨', value: stats.absent, color: ACTION_TYPES.ABSENT.color },
            { label: 'ÙŠØªÙƒÙ„Ù…', value: stats.talking, color: ACTION_TYPES.TALKING.color },
            { label: 'Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡', value: stats.badBehavior, color: ACTION_TYPES.BAD_BEHAVIOR.color }
        ];
        
        const maxValue = Math.max(...chartData.map(d => d.value));
        
        let chartHTML = '';
        chartData.forEach(data => {
            const height = maxValue > 0 ? (data.value / maxValue) * 100 : 0;
            chartHTML += `
                <div style="flex: 1; text-align: center;">
                    <div style="height: 150px; position: relative; display: flex; align-items: flex-end;">
                        <div style="background: ${data.color}; width: 100%; height: ${height}%; border-radius: 8px 8px 0 0; transition: height 1s ease;"></div>
                    </div>
                    <div style="margin-top: 10px; font-weight: bold; color: #4a5568;">${data.label}</div>
                    <div style="font-size: 1.2rem; font-weight: bold; margin-top: 5px;">${data.value}</div>
                </div>
            `;
        });
        
        container.innerHTML = chartHTML;
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    function closeReportModal() {
        document.getElementById('reportModal').style.display = 'none';
    }

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø·Ø§Ù„Ø¨
    function resetStudent(className, name) {
        if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ ${name}ØŸ`)) {
            if (db[className][name]) {
                db[className][name] = {
                    totalScore: 0,
                    actions: [],
                    stats: {
                        participation: 0,
                        goodBehavior: 0,
                        absent: 0,
                        talking: 0,
                        badBehavior: 0
                    },
                    lastAction: null,
                    createdAt: new Date().toISOString()
                };
                
                saveToStorage();
                renderClass(className);
                closeReportModal();
                showNotification('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨', '#f1c40f');
            }
        }
    }

    // ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨
    function exportStudentReport(className, name) {
        const student = db[className][name];
        if (!student) return;
        
        const classNames = {
            'class1': 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„',
            'class2': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ',
            'class3': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«'
        };
        
        let reportData = [];
        reportData.push(['ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨', name]);
        reportData.push(['Ø§Ù„ØµÙ', classNames[className]]);
        reportData.push(['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·', student.totalScore]);
        reportData.push(['Ø¹Ø¯Ø¯ Ø§Ù„ØªØµØ±ÙØ§Øª', student.actions.length]);
        reportData.push(['ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡', new Date().toLocaleDateString('ar-SA')]);
        reportData.push([]);
        reportData.push(['Ù†ÙˆØ¹ Ø§Ù„ØªØµØ±Ù', 'Ø§Ù„Ø¹Ø¯Ø¯']);
        reportData.push(['Ù…Ø´Ø§Ø±ÙƒØ©', student.stats.participation]);
        reportData.push(['Ø³Ù„ÙˆÙƒ Ø­Ø³Ù†', student.stats.goodBehavior]);
        reportData.push(['ØºÙŠØ§Ø¨', student.stats.absent]);
        reportData.push(['ÙŠØªÙƒÙ„Ù…', student.stats.talking]);
        reportData.push(['Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡', student.stats.badBehavior]);
        reportData.push([]);
        reportData.push(['Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„ÙˆÙ‚Øª', 'Ø§Ù„ØªØµØ±Ù', 'Ø§Ù„Ù†Ù‚Ø§Ø·']);
        
        student.actions.forEach(action => {
            reportData.push([
                action.date,
                action.time,
                action.arabicName,
                action.value > 0 ? '+' + action.value : action.value
            ]);
        });
        
        const ws = XLSX.utils.aoa_to_sheet(reportData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨');
        XLSX.writeFile(wb, `ØªÙ‚Ø±ÙŠØ±_${name}_${new Date().toISOString().slice(0,10)}.xlsx`);
        
        showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', '#2ecc71');
    }

    // ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function exportAllData() {
        let allData = [];
        allData.push(['Ø§Ù„ØµÙ', 'Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨', 'Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª', 'Ø³Ù„ÙˆÙƒ Ø­Ø³Ù†', 'ØºÙŠØ§Ø¨', 'ÙŠØªÙƒÙ„Ù…', 'Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡', 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·', 'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«']);
        
        const classNames = {
            'class1': 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„',
            'class2': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ',
            'class3': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«'
        };
        
        ['class1', 'class2', 'class3'].forEach(className => {
            Object.entries(db[className]).forEach(([name, student]) => {
                allData.push([
                    classNames[className],
                    name,
                    student.stats.participation,
                    student.stats.goodBehavior,
                    student.stats.absent,
                    student.stats.talking,
                    student.stats.badBehavior,
                    student.totalScore,
                    student.lastAction ? new Date(student.lastAction).toLocaleDateString('ar-SA') : '-'
                ]);
            });
        });
        
        const ws = XLSX.utils.aoa_to_sheet(allData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…');
        XLSX.writeFile(wb, `Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ù†Ø¸Ø§Ù…_${new Date().toISOString().slice(0,10)}.xlsx`);
        
        showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', '#2ecc71');
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø®Øµ
    function showSummary() {
        let summaryHTML = `
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
        `;
        
        const classNames = {
            'class1': 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„',
            'class2': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ',
            'class3': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«'
        };
        
        let totalStats = {
            students: 0,
            score: 0,
            actions: 0,
            participation: 0,
            goodBehavior: 0,
            absent: 0,
            talking: 0,
            badBehavior: 0
        };
        
        ['class1', 'class2', 'class3'].forEach(className => {
            const students = db[className];
            const studentCount = Object.keys(students).length;
            totalStats.students += studentCount;
            
            if (studentCount === 0) {
                summaryHTML += `
                    <div style="background: #f8fafc; padding: 25px; border-radius: 15px; border-left: 5px solid #a0aec0;">
                        <h3 style="margin-top: 0; color: #2d3748;">${classNames[className]}</h3>
                        <p style="color: #718096;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨</p>
                    </div>
                `;
                return;
            }
            
            let classScore = 0;
            let classActions = 0;
            let topStudent = { name: '', score: -Infinity };
            
            Object.entries(students).forEach(([name, student]) => {
                classScore += student.totalScore;
                classActions += student.actions.length;
                
                totalStats.score += student.totalScore;
                totalStats.actions += student.actions.length;
                totalStats.participation += student.stats.participation;
                totalStats.goodBehavior += student.stats.goodBehavior;
                totalStats.absent += student.stats.absent;
                totalStats.talking += student.stats.talking;
                totalStats.badBehavior += student.stats.badBehavior;
                
                if (student.totalScore > topStudent.score) {
                    topStudent = { name, score: student.totalScore };
                }
            });
            
            const avgScore = (classScore / studentCount).toFixed(1);
            
            summaryHTML += `
                <div style="background: #f8fafc; padding: 25px; border-radius: 15px; border-left: 5px solid #3498db;">
                    <h3 style="margin-top: 0; color: #2d3748;">${classNames[className]}</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                        <div>
                            <div style="font-size: 0.9rem; color: #718096;">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
                            <div style="font-size: 1.8rem; font-weight: bold; color: #2c3e50;">${studentCount}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.9rem; color: #718096;">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                            <div style="font-size: 1.8rem; font-weight: bold; color: ${avgScore >= 0 ? '#27ae60' : '#e74c3c'}">
                                ${avgScore >= 0 ? '+' : ''}${avgScore}
                            </div>
                        </div>
                        <div>
                            <div style="font-size: 0.9rem; color: #718096;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØµØ±ÙØ§Øª</div>
                            <div style="font-size: 1.8rem; font-weight: bold; color: #3498db;">${classActions}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.9rem; color: #718096;">Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·Ø§Ù‹</div>
                            <div style="font-size: 1.1rem; font-weight: bold; color: #9b59b6;">${topStudent.name}</div>
                            <div style="font-size: 0.9rem; color: #718096;">${topStudent.score} Ù†Ù‚Ø·Ø©</div>
                        </div>
                    </div>
                </div>
            `;
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©
        const avgTotalScore = totalStats.students > 0 ? (totalStats.score / totalStats.students).toFixed(1) : 0;
        
        summaryHTML += `
            </div>
            <div style="margin-top: 40px; padding: 30px; background: linear-gradient(to right, #2c3e50, #4a6491); color: white; border-radius: 20px;">
                <h2 style="margin-top: 0; color: white;">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div>
                        <div style="font-size: 0.9rem; opacity: 0.9;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
                        <div style="font-size: 2.5rem; font-weight: bold;">${totalStats.students}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.9rem; opacity: 0.9;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØµØ±ÙØ§Øª</div>
                        <div style="font-size: 2.5rem; font-weight: bold;">${totalStats.actions}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.9rem; opacity: 0.9;">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                        <div style="font-size: 2.5rem; font-weight: bold; color: ${avgTotalScore >= 0 ? '#2ecc71' : '#e74c3c'}">
                            ${avgTotalScore >= 0 ? '+' : ''}${avgTotalScore}
                        </div>
                    </div>
                    <div>
                        <div style="font-size: 0.9rem; opacity: 0.9;">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</div>
                        <div style="font-size: 1.5rem; font-weight: bold;">
                            ${db.stats.lastUpdate ? new Date(db.stats.lastUpdate).toLocaleDateString('ar-SA') : '-'}
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.getElementById('summaryContent').innerHTML = summaryHTML;
        document.getElementById('summaryModal').style.display = 'block';
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù…Ù„Ø®Øµ
    function closeSummaryModal() {
        document.getElementById('summaryModal').style.display = 'none';
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ù…ÙƒØ§Ù†Ùƒ)
    function showSettings() {
        showNotification('Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', '#3498db');
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    function showNotification(message, color) {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.style.background = color;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù…
    function resetSystem() {
        if (confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.")) {
            localStorage.clear();
            location.reload();
        }
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    document.addEventListener('DOMContentLoaded', function() {
        initSystem();
        
        // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ø²Ø± Ø¬Ø¯ÙŠØ¯)
        document.querySelector('.header-actions').innerHTML += `
            <button class="header-btn" onclick="resetSystem()" style="background: rgba(231, 76, 60, 0.2);">
                ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„
            </button>
        `;
    });

    // Ù…Ù†Ø¹ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', function(e) {
            if (e.target === this) {
                this.style.display = 'none';
            }
        });
    });
</script>
</body>
</html>
