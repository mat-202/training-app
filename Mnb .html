<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø³Ù„ÙˆÙƒ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø­Ø³Ù‘Ù†</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --participation: #2980b9;  /* Ø£Ø²Ø±Ù‚ - Ù…Ø´Ø§Ø±ÙƒØ© */
            --good-behavior: #27ae60;   /* Ø£Ø®Ø¶Ø± - Ø³Ù„ÙˆÙƒ Ø­Ø³Ù† */
            --absent: #f1c40f;          /* Ø£ØµÙØ± - ØºÙŠØ§Ø¨ */
            --talking: #e74c3c;         /* Ø£Ø­Ù…Ø± - ÙŠØªÙƒÙ„Ù… */
            --bad-behavior: #8e44ad;    /* Ø¨Ù†ÙØ³Ø¬ÙŠ - Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡ */
            --tab-active: #2c3e50;
            --tab-inactive: #7f8c8d;
            --color-red: #e74c3c;
            --color-orange: #e67e22;
            --color-yellow: #f1c40f;
            --color-green: #2ecc71;
            --color-blue: #3498db;
        }

        * {
            box-sizing: border-box;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 0; 
            padding: 0; 
            min-height: 100vh;
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .main-card {
            background: white;
            border-radius: 25px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.15);
            overflow: hidden;
            min-height: 85vh;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .app-header {
            background: linear-gradient(to right, #2c3e50, #34495e);
            color: white;
            padding: 25px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-title h1 {
            margin: 0;
            font-size: 2.2rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-title p {
            margin: 5px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ÙØµÙˆÙ„ */
        .class-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            padding: 0 40px;
        }

        .class-tab {
            flex: 1;
            text-align: center;
            padding: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
            color: var(--tab-inactive);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .class-tab:hover {
            background: #edf2f7;
            color: var(--tab-active);
        }

        .class-tab.active {
            color: var(--tab-active);
            border-bottom-color: var(--tab-active);
            background: white;
        }

        /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØµÙ„ */
        .class-content {
            padding: 30px 40px;
            display: none;
        }

        .class-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„Ù„ÙØµÙ„ */
        .class-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border-top: 5px solid;
            transition: transform 0.3s ease;
            text-align: center;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
            display: block;
        }

        .stat-label {
            font-size: 1rem;
            color: #7f8c8d;
            display: block;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
        .progress-container {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
        }

        .progress-bar {
            height: 25px;
            background: linear-gradient(to right, var(--color-red) 0%, var(--color-orange) 25%, var(--color-yellow) 50%, var(--color-green) 75%, var(--color-blue) 100%);
            border-radius: 12px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        /* ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ù„ÙˆØ§Ù† */
        .color-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            color: #4a5568;
            background: white;
            padding: 12px 15px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            border-right: 4px solid;
        }

        .legend-color {
            width: 25px;
            height: 25px;
            border-radius: 6px;
        }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ */
        .students-list {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            margin-top: 30px;
        }

        .list-header {
            background: #f8f9fa;
            padding: 20px;
            display: grid;
            grid-template-columns: 2fr 1fr 2fr;
            font-weight: bold;
            color: #2c3e50;
            border-bottom: 2px solid #e9ecef;
        }

        .list-body {
            max-height: 500px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #c1c1c1 #f1f1f1;
        }

        .student-row {
            display: grid;
            grid-template-columns: 2fr 1fr 2fr;
            padding: 20px;
            border-bottom: 1px solid #f1f1f1;
            transition: background 0.3s ease;
            align-items: center;
        }

        .student-row:hover {
            background: #f8fafc;
        }

        .student-info {
            display: flex;
            flex-direction: column;
        }

        .student-name {
            font-weight: 700;
            color: #2d3748;
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .student-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            color: #4a5568;
        }

        .stat-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .percentage-display {
            text-align: center;
        }

        .percentage-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.4rem;
            position: relative;
            margin: 0 auto;
            background: conic-gradient(
                var(--color-red) 0% 25%,
                var(--color-orange) 25% 37.5%,
                var(--color-yellow) 37.5% 50%,
                var(--color-green) 50% 75%,
                var(--color-blue) 75% 100%
            );
        }

        .percentage-circle::before {
            content: attr(data-percentage) '%';
            position: absolute;
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .average-display {
            font-size: 0.9rem;
            margin-top: 8px;
            color: #7f8c8d;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-action {
            border: none;
            width: 55px;
            height: 55px;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            font-size: 1.3rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .btn-action:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .btn-action:active {
            transform: scale(0.95);
        }

        /* Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */
        .floating-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            border: none;
        }

        .floating-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        /* Ø§Ù„ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 1024px) {
            .app-container {
                padding: 10px;
            }
            
            .app-header {
                padding: 20px;
                flex-direction: column;
                text-align: center;
            }
            
            .class-tabs {
                padding: 0;
            }
            
            .class-content {
                padding: 20px;
            }
            
            .student-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .list-header {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .class-tabs {
                flex-direction: column;
            }
            
            .header-title h1 {
                font-size: 1.8rem;
            }
            
            .btn-action {
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }
        }

        /* ØªØ®ØµÙŠØµØ§Øª Ù„Ù„Ø£Ù„ÙˆØ§Ù† Ø­Ø³Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© */
        .percentage-0-49 { color: var(--color-red); }
        .percentage-50 { color: var(--color-yellow); }
        .percentage-51-100 { color: var(--color-green); }
    </style>
</head>
<body>
    <!-- Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
    <button class="floating-btn" onclick="showAddStudentModal()">+</button>

    <div class="app-container">
        <div class="main-card">
            <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
            <div class="app-header">
                <div class="header-title">
                    <h1>ğŸ« Ù†Ø¸Ø§Ù… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø³Ù„ÙˆÙƒ</h1>
                    <p>Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¦ÙˆÙŠ: Ù…Ù† 0% Ø¥Ù„Ù‰ 100% Ø­Ø³Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·</p>
                </div>
            </div>

            <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ÙØµÙˆÙ„ -->
            <div class="class-tabs">
                <div class="class-tab active" onclick="showClass('class1')">
                    ğŸ“š Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„
                    <span class="student-count" id="tab-count-1">0</span>
                </div>
                <div class="class-tab" onclick="showClass('class2')">
                    ğŸ“š Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ
                    <span class="student-count" id="tab-count-2">0</span>
                </div>
                <div class="class-tab" onclick="showClass('class3')">
                    ğŸ“š Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«
                    <span class="student-count" id="tab-count-3">0</span>
                </div>
            </div>

            <!-- ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ù„ÙˆØ§Ù† -->
            <div class="color-legend">
                <div class="legend-item" style="border-right-color: var(--participation);">
                    <div class="legend-color" style="background: var(--participation);"></div>
                    <div>
                        <div style="font-weight: bold;">+Ù¢ Ù…Ø´Ø§Ø±ÙƒØ©</div>
                        <div style="font-size: 0.8rem; color: #718096;">(ÙŠØ²ÙŠØ¯ Ø§Ù„Ù†Ø³Ø¨Ø©)</div>
                    </div>
                </div>
                <div class="legend-item" style="border-right-color: var(--good-behavior);">
                    <div class="legend-color" style="background: var(--good-behavior);"></div>
                    <div>
                        <div style="font-weight: bold;">+Ù¡ Ø³Ù„ÙˆÙƒ Ø­Ø³Ù†</div>
                        <div style="font-size: 0.8rem; color: #718096;">(ÙŠØ²ÙŠØ¯ Ø§Ù„Ù†Ø³Ø¨Ø©)</div>
                    </div>
                </div>
                <div class="legend-item" style="border-right-color: var(--absent);">
                    <div class="legend-color" style="background: var(--absent);"></div>
                    <div>
                        <div style="font-weight: bold;">Ù  ØºÙŠØ§Ø¨</div>
                        <div style="font-size: 0.8rem; color: #718096;">(ÙŠØ®ÙØ¶ Ø§Ù„Ù…ØªÙˆØ³Ø·)</div>
                    </div>
                </div>
                <div class="legend-item" style="border-right-color: var(--talking);">
                    <div class="legend-color" style="background: var(--talking);"></div>
                    <div>
                        <div style="font-weight: bold;">-Ù¡ ÙŠØªÙƒÙ„Ù…</div>
                        <div style="font-size: 0.8rem; color: #718096;">(ÙŠØ®ÙØ¶ Ø§Ù„Ù†Ø³Ø¨Ø©)</div>
                    </div>
                </div>
                <div class="legend-item" style="border-right-color: var(--bad-behavior);">
                    <div class="legend-color" style="background: var(--bad-behavior);"></div>
                    <div>
                        <div style="font-weight: bold;">-Ù¢ Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡</div>
                        <div style="font-size: 0.8rem; color: #718096;">(ÙŠØ®ÙØ¶ Ø§Ù„Ù†Ø³Ø¨Ø© Ø¨Ø´Ø¯Ø©)</div>
                    </div>
                </div>
            </div>

            <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ -->
            <div class="progress-container">
                <h3 style="margin-top: 0; color: #2c3e50;">Ù…Ø®Ø·Ø· Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©:</h3>
                <div class="progress-bar"></div>
                <div class="progress-labels">
                    <span>0% (Ù…ØªÙˆØ³Ø· -2)</span>
                    <span>25% (Ù…ØªÙˆØ³Ø· -1)</span>
                    <span>50% (Ù…ØªÙˆØ³Ø· 0)</span>
                    <span>75% (Ù…ØªÙˆØ³Ø· +1)</span>
                    <span>100% (Ù…ØªÙˆØ³Ø· +2)</span>
                </div>
                <p style="margin: 10px 0 0 0; color: #7f8c8d; font-size: 0.9rem;">
                    <strong>Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨:</strong> Ø§Ù„Ù†Ø³Ø¨Ø© = (Ø§Ù„Ù…ØªÙˆØ³Ø· + 2) Ã— 25<br>
                    Ø­ÙŠØ«: Ø§Ù„Ù…ØªÙˆØ³Ø· = Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ã· Ø¹Ø¯Ø¯ Ø§Ù„Ø¶ØºØ·Ø§Øª
                </p>
            </div>

            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØµÙˆÙ„ -->
            <div id="class1-content" class="class-content active">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>

            <div id="class2-content" class="class-content">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>

            <div id="class3-content" class="class-content">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ -->
    <div id="addStudentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin: 0; font-size: 1.8rem;">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                <button class="close-modal" onclick="closeAddStudentModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; gap: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ø§Ø®ØªØ± Ø§Ù„ØµÙ:</label>
                        <select id="addClassSelect" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #ddd;">
                            <option value="class1">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„</option>
                            <option value="class2">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                            <option value="class3">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
                        <input type="text" id="addStudentName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #ddd;">
                    </div>
                    <button onclick="addStudent()" style="background: linear-gradient(to right, #2ecc71, #27ae60); color: white; border: none; padding: 15px; border-radius: 10px; font-weight: bold; font-size: 1.1rem; cursor: pointer;">
                        â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="reportTitle" style="margin: 0; font-size: 1.8rem;">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
                <button class="close-modal" onclick="closeReportModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div id="reportContent">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
        </div>
    </div>

<script>
    // ØªØ¹Ø±ÙŠÙ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØµØ±ÙØ§Øª
    const ACTION_TYPES = {
        PARTICIPATION: {
            value: 2,
            color: '#2980b9',
            name: 'Ù…Ø´Ø§Ø±ÙƒØ©',
            arabicName: 'Ù…Ø´Ø§Ø±ÙƒØ©',
            icon: 'ğŸ’¬'
        },
        GOOD_BEHAVIOR: {
            value: 1,
            color: '#27ae60',
            name: 'Ø³Ù„ÙˆÙƒ Ø­Ø³Ù†',
            arabicName: 'Ø³Ù„ÙˆÙƒ Ø­Ø³Ù†',
            icon: 'ğŸ‘'
        },
        ABSENT: {
            value: 0,
            color: '#f1c40f',
            name: 'ØºÙŠØ§Ø¨',
            arabicName: 'ØºÙŠØ§Ø¨',
            icon: 'ğŸ“'
        },
        TALKING: {
            value: -1,
            color: '#e74c3c',
            name: 'ÙŠØªÙƒÙ„Ù…',
            arabicName: 'ÙŠØªÙƒÙ„Ù…',
            icon: 'ğŸ—£ï¸'
        },
        BAD_BEHAVIOR: {
            value: -2,
            color: '#8e44ad',
            name: 'Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡',
            arabicName: 'Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡',
            icon: 'ğŸ‘'
        }
    };

    // Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    let db = JSON.parse(localStorage.getItem('behaviorDB')) || { 
        class1: {}, 
        class2: {}, 
        class3: {},
        version: '2.0'
    };

    // Ø§Ù„ÙØµÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶
    let currentClass = 'class1';

    // Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©
    function calculatePercentage(student) {
        if (student.actions.length === 0) return 50;
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØªÙˆØ³Ø·: Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ã· Ø¹Ø¯Ø¯ Ø§Ù„Ø¶ØºØ·Ø§Øª
        const average = student.totalScore / student.actions.length;
        
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©: Ø§Ù„Ù†Ø³Ø¨Ø© = (Ø§Ù„Ù…ØªÙˆØ³Ø· + 2) Ã— 25
        // Ù„Ø£Ù†: -2 â†’ 0%, -1 â†’ 25%, 0 â†’ 50%, +1 â†’ 75%, +2 â†’ 100%
        let percentage = (average + 2) * 25;
        
        // ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„Ù†Ø³Ø¨Ø© Ø¨ÙŠÙ† 0 Ùˆ 100
        return Math.max(0, Math.min(100, Math.round(percentage)));
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù„ÙˆÙ† Ø§Ù„Ù†Ø³Ø¨Ø©
    function getPercentageColor(percentage) {
        if (percentage < 50) return '#e74c3c';     // Ø£Ø­Ù…Ø± Ù„Ù„Ù†Ø³Ø¨ ØªØ­Øª 50%
        if (percentage === 50) return '#f1c40f';   // Ø£ØµÙØ± Ù„Ù„Ù†Ø³Ø¨Ø© 50%
        if (percentage > 50) return '#27ae60';     // Ø£Ø®Ø¶Ø± Ù„Ù„Ù†Ø³Ø¨ ÙÙˆÙ‚ 50%
        return '#95a5a6';                          // Ø±Ù…Ø§Ø¯ÙŠ ÙƒØ§Ø­ØªÙŠØ§Ø·ÙŠ
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙØ¦Ø© Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ CSS
    function getPercentageClass(percentage) {
        if (percentage < 50) return 'percentage-0-49';
        if (percentage === 50) return 'percentage-50';
        return 'percentage-51-100';
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    function initSystem() {
        if (!db.version) {
            db = { 
                class1: {}, 
                class2: {}, 
                class3: {},
                version: '2.0'
            };
        }
        saveToStorage();
        renderAllClasses();
    }

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function saveToStorage() {
        localStorage.setItem('behaviorDB', JSON.stringify(db));
    }

    // Ø¹Ø±Ø¶ ÙØµÙ„ Ù…Ø¹ÙŠÙ†
    function showClass(className) {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø·
        document.querySelectorAll('.class-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        document.querySelectorAll('.class-content').forEach(content => {
            content.classList.remove('active');
        });

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø´Ø· Ù„Ù„ØªØ¨ÙˆÙŠØ¨ ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ø¯Ø¯
        event.currentTarget.classList.add('active');
        document.getElementById(`${className}-content`).classList.add('active');
        currentClass = className;

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ÙØµÙ„
        renderClass(className);
    }

    // Ø¥Ø¶Ø§ÙØ© ØªØµØ±Ù Ù„Ù„Ø·Ø§Ù„Ø¨
    function addAction(cls, name, actionType) {
        if (!db[cls][name]) return;
        
        const action = {
            type: actionType.name,
            value: actionType.value,
            arabicName: actionType.arabicName,
            color: actionType.color,
            timestamp: new Date().toISOString(),
            date: new Date().toLocaleDateString('ar-SA'),
            time: new Date().toLocaleTimeString('ar-SA')
        };
        
        db[cls][name].actions.push(action);
        db[cls][name].totalScore += actionType.value;
        db[cls][name].lastAction = new Date().toISOString();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        switch(actionType.name) {
            case 'Ù…Ø´Ø§Ø±ÙƒØ©': db[cls][name].stats.participation++; break;
            case 'Ø³Ù„ÙˆÙƒ Ø­Ø³Ù†': db[cls][name].stats.goodBehavior++; break;
            case 'ØºÙŠØ§Ø¨': db[cls][name].stats.absent++; break;
            case 'ÙŠØªÙƒÙ„Ù…': db[cls][name].stats.talking++; break;
            case 'Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡': db[cls][name].stats.badBehavior++; break;
        }
        
        saveToStorage();
        renderClass(cls);
        
        // Ø¥Ø´Ø¹Ø§Ø±
        showNotification(`${actionType.arabicName} ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${name} Ù„Ù€`, actionType.color);
    }

    // Ø¹Ø±Ø¶ Ø§Ù„ÙØµÙ„
    function renderClass(className) {
        const container = document.getElementById(`${className}-content`);
        const students = db[className];
        const studentCount = Object.keys(students).length;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        document.getElementById(`tab-count-${className.slice(-1)}`).textContent = studentCount;

        if (studentCount === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 60px 20px; color: #a0aec0;">
                    <div style="font-size: 5rem; margin-bottom: 20px;">ğŸ‘¨â€ğŸ“</div>
                    <h3 style="margin-bottom: 10px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØµÙ</h3>
                    <p>Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© (+) Ù„Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø§Ø¨</p>
                </div>
            `;
            return;
        }

        // Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙØµÙ„
        let classStats = {
            totalStudents: studentCount,
            totalScore: 0,
            totalActions: 0,
            avgPercentage: 0,
            participation: 0,
            goodBehavior: 0,
            absent: 0,
            talking: 0,
            badBehavior: 0
        };

        Object.values(students).forEach(student => {
            classStats.totalScore += student.totalScore;
            classStats.totalActions += student.actions.length;
            classStats.participation += student.stats.participation;
            classStats.goodBehavior += student.stats.goodBehavior;
            classStats.absent += student.stats.absent;
            classStats.talking += student.stats.talking;
            classStats.badBehavior += student.stats.badBehavior;
        });

        // Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„ÙØµÙ„
        let totalPercentage = 0;
        let studentsWithActions = 0;
        
        Object.values(students).forEach(student => {
            if (student.actions.length > 0) {
                totalPercentage += calculatePercentage(student);
                studentsWithActions++;
            }
        });
        
        classStats.avgPercentage = studentsWithActions > 0 ? 
            Math.round(totalPercentage / studentsWithActions) : 0;

        const avgScore = classStats.totalActions > 0 ? 
            (classStats.totalScore / classStats.totalActions).toFixed(2) : 0;

        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØµÙ„
        let content = `
            <div class="class-stats">
                <div class="stat-card" style="border-top-color: #3498db;">
                    <span class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                    <span class="stat-value">${classStats.totalStudents}</span>
                </div>
                <div class="stat-card" style="border-top-color: #2ecc71;">
                    <span class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ø³Ø¨Ø©</span>
                    <span class="stat-value" style="color: ${getPercentageColor(classStats.avgPercentage)}">
                        ${classStats.avgPercentage}%
                    </span>
                </div>
                <div class="stat-card" style="border-top-color: #9b59b6;">
                    <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØµØ±ÙØ§Øª</span>
                    <span class="stat-value">${classStats.totalActions}</span>
                </div>
                <div class="stat-card" style="border-top-color: #f1c40f;">
                    <span class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·</span>
                    <span class="stat-value" style="color: ${avgScore >= 0 ? '#27ae60' : '#e74c3c'}">
                        ${avgScore >= 0 ? '+' : ''}${avgScore}
                    </span>
                </div>
            </div>

            <div class="students-list">
                <div class="list-header">
                    <div>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</div>
                    <div>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div>
                    <div>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</div>
                </div>
                <div class="list-body">
        `;

        // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© (Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)
        const sortedStudents = Object.entries(students).sort((a, b) => {
            const percA = calculatePercentage(a[1]);
            const percB = calculatePercentage(b[1]);
            return percB - percA;
        });

        sortedStudents.forEach(([name, data], index) => {
            const percentage = calculatePercentage(data);
            const stats = data.stats;
            const average = data.actions.length > 0 ? (data.totalScore / data.actions.length).toFixed(2) : 0;
            
            content += `
                <div class="student-row">
                    <div class="student-info">
                        <div class="student-name">
                            <span style="color: #718096; margin-left: 10px;">#${index + 1}</span>
                            ${name}
                        </div>
                        <div class="student-stats">
                            <div class="stat-item">
                                <div class="stat-dot" style="background: ${ACTION_TYPES.PARTICIPATION.color}"></div>
                                <span>${stats.participation}</span>
                            </div>
                            <div class="stat-item">
                                <div class="stat-dot" style="background: ${ACTION_TYPES.GOOD_BEHAVIOR.color}"></div>
                                <span>${stats.goodBehavior}</span>
                            </div>
                            <div class="stat-item">
                                <div class="stat-dot" style="background: ${ACTION_TYPES.ABSENT.color}"></div>
                                <span>${stats.absent}</span>
                            </div>
                            <div class="stat-item">
                                <div class="stat-dot" style="background: ${ACTION_TYPES.TALKING.color}"></div>
                                <span>${stats.talking}</span>
                            </div>
                            <div class="stat-item">
                                <div class="stat-dot" style="background: ${ACTION_TYPES.BAD_BEHAVIOR.color}"></div>
                                <span>${stats.badBehavior}</span>
                            </div>
                        </div>
                        <button onclick="showStudentReport('${className}', '${name}')" 
                                style="background: #718096; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; margin-top: 10px; font-size: 0.9rem;">
                            ğŸ“„ Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                    </div>
                    <div class="percentage-display">
                        <div class="percentage-circle" data-percentage="${percentage}"></div>
                        <div class="average-display">
                            Ù…ØªÙˆØ³Ø·: ${average >= 0 ? '+' : ''}${average}<br>
                            ${data.actions.length} Ø¶ØºØ·Ø©
                        </div>
                        <div style="margin-top: 5px; font-weight: bold; font-size: 1.1rem; color: ${getPercentageColor(percentage)}">
                            ${percentage}%
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn-action" style="background: ${ACTION_TYPES.PARTICIPATION.color}"
                                onclick="addAction('${className}', '${name}', ACTION_TYPES.PARTICIPATION)"
                                title="Ù…Ø´Ø§Ø±ÙƒØ© +Ù¢">
                            +Ù¢
                        </button>
                        <button class="btn-action" style="background: ${ACTION_TYPES.GOOD_BEHAVIOR.color}"
                                onclick="addAction('${className}', '${name}', ACTION_TYPES.GOOD_BEHAVIOR)"
                                title="Ø³Ù„ÙˆÙƒ Ø­Ø³Ù† +Ù¡">
                            +Ù¡
                        </button>
                        <button class="btn-action" style="background: ${ACTION_TYPES.ABSENT.color}"
                                onclick="addAction('${className}', '${name}', ACTION_TYPES.ABSENT)"
                                title="ØºÙŠØ§Ø¨ Ù ">
                            Ù 
                        </button>
                        <button class="btn-action" style="background: ${ACTION_TYPES.TALKING.color}"
                                onclick="addAction('${className}', '${name}', ACTION_TYPES.TALKING)"
                                title="ÙŠØªÙƒÙ„Ù… -Ù¡">
                            -Ù¡
                        </button>
                        <button class="btn-action" style="background: ${ACTION_TYPES.BAD_BEHAVIOR.color}"
                                onclick="addAction('${className}', '${name}', ACTION_TYPES.BAD_BEHAVIOR)"
                                title="Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡ -Ù¢">
                            -Ù¢
                        </button>
                    </div>
                </div>
            `;
        });

        content += `
                </div>
            </div>
        `;

        container.innerHTML = content;
    }

    // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµÙˆÙ„
    function renderAllClasses() {
        ['class1', 'class2', 'class3'].forEach(cls => {
            renderClass(cls);
        });
    }

    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨
    function showAddStudentModal() {
        document.getElementById('addStudentModal').style.display = 'block';
    }

    function closeAddStudentModal() {
        document.getElementById('addStudentModal').style.display = 'none';
        document.getElementById('addStudentName').value = '';
    }

    // Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
    function addStudent() {
        const className = document.getElementById('addClassSelect').value;
        const name = document.getElementById('addStudentName').value.trim();
        
        if (!name) {
            showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨', '#e74c3c');
            return;
        }
        
        if (!db[className][name]) {
            db[className][name] = {
                totalScore: 0,
                actions: [],
                stats: {
                    participation: 0,
                    goodBehavior: 0,
                    absent: 0,
                    talking: 0,
                    badBehavior: 0
                },
                lastAction: null,
                createdAt: new Date().toISOString()
            };
            
            saveToStorage();
            renderClass(className);
            
            // Ø¹Ø±Ø¶ Ø§Ù„ÙØµÙ„ Ø§Ù„Ù…Ø¶Ø§Ù Ø¥Ù„ÙŠÙ‡
            showClass(className);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
            closeAddStudentModal();
            
            showNotification(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ ${name}`, '#2ecc71');
        } else {
            showNotification('Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', '#f1c40f');
        }
    }

    // Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨
    function showStudentReport(className, name) {
        const student = db[className][name];
        if (!student) return;
        
        const classNames = {
            'class1': 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„',
            'class2': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ',
            'class3': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«'
        };
        
        const percentage = calculatePercentage(student);
        const average = student.actions.length > 0 ? (student.totalScore / student.actions.length).toFixed(2) : 0;
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†Ø³Ø¨ÙŠ
        const totalActions = student.actions.length;
        const percentages = {
            participation: totalActions > 0 ? Math.round((student.stats.participation / totalActions) * 100) : 0,
            goodBehavior: totalActions > 0 ? Math.round((student.stats.goodBehavior / totalActions) * 100) : 0,
            absent: totalActions > 0 ? Math.round((student.stats.absent / totalActions) * 100) : 0,
            talking: totalActions > 0 ? Math.round((student.stats.talking / totalActions) * 100) : 0,
            badBehavior: totalActions > 0 ? Math.round((student.stats.badBehavior / totalActions) * 100) : 0
        };
        
        let reportHTML = `
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <h3 style="margin-top: 0; color: #2d3748;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
                    <div style="background: #f8fafc; padding: 25px; border-radius: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                            <div>
                                <div style="font-size: 0.9rem; color: #718096;">Ø§Ù„Ø§Ø³Ù…</div>
                                <div style="font-size: 1.8rem; font-weight: bold; color: #2c3e50;">${name}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9rem; color: #718096;">Ø§Ù„ØµÙ</div>
                                <div style="font-size: 1.8rem; font-weight: bold; color: #2c3e50;">${classNames[className]}</div>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 12px; margin-top: 20px;">
                            <div style="text-align: center;">
                                <div style="font-size: 0.9rem; color: #718096;">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</div>
                                <div style="font-size: 3.5rem; font-weight: bold; color: ${getPercentageColor(percentage)}; margin: 10px 0;">
                                    ${percentage}%
                                </div>
                                <div style="font-size: 1rem; color: #7f8c8d;">
                                    Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·: ${average >= 0 ? '+' : ''}${average} | Ø¹Ø¯Ø¯ Ø§Ù„Ø¶ØºØ·Ø§Øª: ${totalActions}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px; color: #2d3748;">ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªØµØ±ÙØ§Øª</h3>
                    <div id="chartContainer" style="margin-top: 20px;">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </div>
                </div>
                
                <div>
                    <h3 style="margin-top: 0; color: #2d3748;">Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©</h3>
                    <div style="background: #f8fafc; padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: bold; color: #2c3e50;">Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨:</div>
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 10px; font-family: monospace;">
                                Ø§Ù„Ù†Ø³Ø¨Ø© = (Ø§Ù„Ù…ØªÙˆØ³Ø· + 2) Ã— 25<br>
                                Ø­ÙŠØ«: Ø§Ù„Ù…ØªÙˆØ³Ø· = Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ã· Ø¹Ø¯Ø¯ Ø§Ù„Ø¶ØºØ·Ø§Øª
                            </div>
                        </div>
                        <div>
                            <div style="font-weight: bold; color: #2c3e50;">Ø­Ø³Ø§Ø¨ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø©:</div>
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 10px;">
                                Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·: ${student.totalScore}<br>
                                Ø¹Ø¯Ø¯ Ø§Ù„Ø¶ØºØ·Ø§Øª: ${totalActions}<br>
                                Ø§Ù„Ù…ØªÙˆØ³Ø·: ${average} = ${student.totalScore} Ã· ${totalActions}<br>
                                Ø§Ù„Ù†Ø³Ø¨Ø©: (${average} + 2) Ã— 25 = ${percentage}%
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 0; color: #2d3748;">Ø³Ø¬Ù„ Ø§Ù„ØªØµØ±ÙØ§Øª</h3>
                    <div style="max-height: 300px; overflow-y: auto; border: 2px solid #edf2f7; border-radius: 12px; padding: 15px;">
        `;
        
        if (student.actions.length === 0) {
            reportHTML += `
                <div style="text-align: center; padding: 40px; color: #a0aec0;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">ğŸ“</div>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØµØ±ÙØ§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</p>
                </div>
            `;
        } else {
            const recentActions = [...student.actions].reverse().slice(0, 10);
            
            recentActions.forEach(action => {
                reportHTML += `
                    <div style="padding: 12px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: bold; margin-bottom: 5px; color: ${action.color};">${action.arabicName}</div>
                            <div style="font-size: 0.85rem; color: #718096;">
                                ${action.date} - ${action.time}
                            </div>
                        </div>
                        <div>
                            <span style="background: ${action.color}; color: white; padding: 5px 12px; border-radius: 20px; font-weight: bold;">
                                ${action.value > 0 ? '+' : ''}${action.value}
                            </span>
                        </div>
                    </div>
                `;
            });
        }
        
        reportHTML += `
                    </div>
                    <div style="margin-top: 20px;">
                        <button onclick="exportStudentReport('${className}', '${name}')" 
                                style="background: #2ecc71; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%;">
                            ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.getElementById('reportTitle').textContent = `ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨: ${name}`;
        document.getElementById('reportContent').innerHTML = reportHTML;
        document.getElementById('reportModal').style.display = 'block';
        
        // Ø±Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
        setTimeout(() => drawChart(percentages), 100);
    }

    // Ø±Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
    function drawChart(percentages) {
        const container = document.getElementById('chartContainer');
        if (!container) return;
        
        const chartData = [
            { label: 'Ù…Ø´Ø§Ø±ÙƒØ©', value: percentages.participation, color: ACTION_TYPES.PARTICIPATION.color },
            { label: 'Ø³Ù„ÙˆÙƒ Ø­Ø³Ù†', value: percentages.goodBehavior, color: ACTION_TYPES.GOOD_BEHAVIOR.color },
            { label: 'ØºÙŠØ§Ø¨', value: percentages.absent, color: ACTION_TYPES.ABSENT.color },
            { label: 'ÙŠØªÙƒÙ„Ù…', value: percentages.talking, color: ACTION_TYPES.TALKING.color },
            { label: 'Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡', value: percentages.badBehavior, color: ACTION_TYPES.BAD_BEHAVIOR.color }
        ];
        
        let chartHTML = `
            <div style="display: grid; gap: 15px;">
        `;
        
        chartData.forEach(data => {
            chartHTML += `
                <div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-weight: bold; color: #4a5568;">${data.label}</span>
                        <span style="color: #718096;">${data.value}%</span>
                    </div>
                    <div style="height: 20px; background: #e2e8f0; border-radius: 10px; overflow: hidden;">
                        <div style="height: 100%; width: ${data.value}%; background: ${data.color}; border-radius: 10px; transition: width 1s ease;"></div>
                    </div>
                </div>
            `;
        });
        
        chartHTML += `</div>`;
        container.innerHTML = chartHTML;
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    function closeReportModal() {
        document.getElementById('reportModal').style.display = 'none';
    }

    // ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨
    function exportStudentReport(className, name) {
        const student = db[className][name];
        if (!student) return;
        
        const classNames = {
            'class1': 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„',
            'class2': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ',
            'class3': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«'
        };
        
        const percentage = calculatePercentage(student);
        const average = student.actions.length > 0 ? (student.totalScore / student.actions.length).toFixed(2) : 0;
        
        let reportData = [];
        reportData.push(['ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨', name]);
        reportData.push(['Ø§Ù„ØµÙ', classNames[className]]);
        reportData.push(['Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©', percentage + '%']);
        reportData.push(['Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·', average]);
        reportData.push(['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·', student.totalScore]);
        reportData.push(['Ø¹Ø¯Ø¯ Ø§Ù„Ø¶ØºØ·Ø§Øª', student.actions.length]);
        reportData.push(['ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡', new Date().toLocaleDateString('ar-SA')]);
        reportData.push([]);
        reportData.push(['Ù†ÙˆØ¹ Ø§Ù„ØªØµØ±Ù', 'Ø§Ù„Ø¹Ø¯Ø¯', 'Ø§Ù„Ù†Ø³Ø¨Ø©']);
        reportData.push(['Ù…Ø´Ø§Ø±ÙƒØ©', student.stats.participation, Math.round((student.stats.participation / student.actions.length) * 100) + '%']);
        reportData.push(['Ø³Ù„ÙˆÙƒ Ø­Ø³Ù†', student.stats.goodBehavior, Math.round((student.stats.goodBehavior / student.actions.length) * 100) + '%']);
        reportData.push(['ØºÙŠØ§Ø¨', student.stats.absent, Math.round((student.stats.absent / student.actions.length) * 100) + '%']);
        reportData.push(['ÙŠØªÙƒÙ„Ù…', student.stats.talking, Math.round((student.stats.talking / student.actions.length) * 100) + '%']);
        reportData.push(['Ø³Ù„ÙˆÙƒ Ø³ÙŠØ¡', student.stats.badBehavior, Math.round((student.stats.badBehavior / student.actions.length) * 100) + '%']);
        reportData.push([]);
        reportData.push(['Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„ÙˆÙ‚Øª', 'Ø§Ù„ØªØµØ±Ù', 'Ø§Ù„Ù†Ù‚Ø§Ø·']);
        
        student.actions.forEach(action => {
            reportData.push([
                action.date,
                action.time,
                action.arabicName,
                action.value > 0 ? '+' + action.value : action.value
            ]);
        });
        
        const ws = XLSX.utils.aoa_to_sheet(reportData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨');
        XLSX.writeFile(wb, `ØªÙ‚Ø±ÙŠØ±_${name}_${new Date().toISOString().slice(0,10)}.xlsx`);
        
        showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', '#2ecc71');
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    function showNotification(message, color) {
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            left: 20px;
            background: ${color};
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            z-index: 10000;
            font-weight: bold;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        // Ø¥Ø¶Ø§ÙØ© Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(-100px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(-100px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
        setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    document.addEventListener('DOMContentLoaded', function() {
        initSystem();
        
        // Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· CSS Ù„Ù„Ù…ÙˆØ¯Ø§Ù„
        const modalStyle = document.createElement('style');
        modalStyle.textContent = `
            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 2000;
                overflow-y: auto;
                padding: 20px;
            }
            
            .modal-content {
                background: white;
                width: 90%;
                max-width: 900px;
                margin: 30px auto;
                border-radius: 25px;
                overflow: hidden;
                box-shadow: 0 25px 50px rgba(0,0,0,0.3);
                animation: modalSlideIn 0.5s ease;
            }
            
            @keyframes modalSlideIn {
                from { transform: translateY(-50px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
            
            .modal-header {
                background: linear-gradient(to right, #2c3e50, #34495e);
                color: white;
                padding: 25px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .modal-body {
                padding: 30px;
            }
            
            .close-modal {
                background: rgba(255,255,255,0.2);
                border: none;
                color: white;
                font-size: 1.5rem;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .close-modal:hover {
                background: rgba(255,255,255,0.3);
                transform: rotate(90deg);
            }
        `;
        document.head.appendChild(modalStyle);
        
        // Ù…Ù†Ø¹ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
        });
    });
</script>
</body>
</html>
